<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulatore Budget Stagionale | Gare dinamiche</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root { color-scheme: light; --bg:#edf2f7; --surface:#fff; --surface-alt:#f7fafc; --border:#d8e0eb; --primary:#2563eb; --primary-dark:#1d4ed8; --text:#0f172a; --text-muted:#475569; }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.5}
    header.hero{padding:48px 24px 32px;text-align:center;background:linear-gradient(180deg,rgba(37,99,235,.12),rgba(37,99,235,0))}
    header.hero h1{margin:0;font-weight:700;font-size:clamp(2rem,3vw,2.8rem)}
    header.hero p{max-width:820px;margin:16px auto 0;color:var(--text-muted)}
    main{max-width:1280px;margin:0 auto;padding:0 24px 64px}
    .layout-grid{display:grid;grid-template-columns:420px 1fr;align-items:start;gap:32px}
    .panel,.card{background:var(--surface);border-radius:18px;border:1px solid var(--border);padding:24px;box-shadow:0 14px 34px rgba(15,23,42,.08);overflow:hidden}
    .section-title{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:4px 0 12px}
    .muted{color:var(--text-muted);font-size:.9rem}
    label{display:flex;flex-direction:column;gap:6px;font-size:.88rem;color:var(--text-muted)}
    label span{color:var(--text);font-weight:600}
    input[type="number"],input[type="text"]{border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:.95rem;width:100%}
    input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}.col-12{grid-column:span 12}
    .button-row{display:flex;flex-wrap:wrap;gap:10px}
    button{border:none;border-radius:999px;padding:10px 16px;font-weight:600;cursor:pointer}
    button.primary{background:var(--primary);color:#fff}button.primary:hover{background:var(--primary-dark)}
    button.secondary{background:var(--surface-alt);border:1px solid var(--border)}
    button.ghost{background:transparent;border:1px dashed var(--border);color:var(--text-muted)}
    .insight-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin:18px 0 6px}
    .insight-card{background:var(--surface-alt);border:1px solid rgba(148,163,184,.4);border-radius:14px;padding:12px}
    .insight-card h4{margin:0 0 6px;font-size:.82rem;color:var(--text-muted)}
    .insight-card p{margin:0;font-size:1.05rem;font-weight:700}
    .annualized{border-color:var(--primary);background:rgba(37,99,235,.05)}
    .table-wrapper{border:1px solid var(--border);border-radius:16px;overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:.92rem}
    thead th{text-align:left;padding:10px 12px;font-size:.78rem;text-transform:uppercase;letter-spacing:.04em;color:var(--text-muted);border-bottom:1px solid var(--border)}
    tbody td{padding:10px 12px;border-bottom:1px solid var(--border)}
    tfoot th{padding:12px;text-align:right}
    .summary-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin:4px 0 20px}
    .summary-box{padding:16px;background:var(--surface-alt);border:1px solid rgba(148,163,184,.35);border-radius:14px}
    .summary-box h4{margin:0 0 8px;font-size:.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em}
    .summary-box p{margin:0;font-size:1.2rem;font-weight:700}
    .tag{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:var(--surface-alt);padding:6px 10px;border-radius:999px;font-size:.8rem}
    .charts-grid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));margin-top:16px}
    .charts-grid .card{border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:none}
    @media (max-width:1100px){.layout-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="hero">
    <h1>Simulatore di Budget Stagionale</h1>
    <p>Gestisci le <strong>gare</strong> una ad una (titolo, luogo, km, iscrizione, alloggio) e i <strong>costi fissi</strong> (leasing auto e abbigliamento). Calcolo, ripartizione e grafici aggiornati in tempo reale.</p>
  </header>

  <main>
    <div class="layout-grid">
      <!-- SINISTRA: Parametri base + costi fissi + aggiunta gara -->
      <aside class="panel">
        <div class="section-title">
          <h2 style="margin:0">Parametri & Costi</h2>
          <span class="tag" id="race-count-tag">0 gare</span>
        </div>

        <!-- Costi fissi -->
        <section aria-labelledby="fixed-title">
          <div class="section-title"><h3 id="fixed-title" style="margin:0">Costi fissi</h3></div>
          <div class="row">
            <label class="col-6"><span>Leasing/Auto (â‚¬/mese)</span><input id="fixed-vehicle-month" type="number" min="0" step="10"></label>
            <label class="col-6"><span>Abbigliamento (â‚¬/anno)</span><input id="fixed-clothing" type="number" min="0" step="50"></label>
          </div>
          <div class="insight-grid">
            <div class="insight-card annualized"><h4>Costo veicoli annuale</h4><p id="insight-annual-vehicle">â€“</p></div>
          </div>
        </section>
        <hr style="border:none;border-top:1px solid var(--border);margin:16px 0;">

        <!-- Parametri dinamici -->
        <section aria-labelledby="dynamic-title">
          <div class="section-title"><h3 id="dynamic-title" style="margin:0">Parametri dinamici</h3></div>
          <div class="row">
            <label class="col-4"><span>Prezzo carburante (â‚¬/L)</span><input id="fuel-price" type="number" min="0" step="0.01"></label>
            <label class="col-4"><span>Consumo (L/100km)</span><input id="fuel-cons" type="number" min="0" step="0.1"></label>
            <label class="col-4"><span>Pedaggi (â‚¬/km)</span><input id="toll-per-km" type="number" min="0" step="0.01"></label>
          </div>
          <div class="insight-grid">
            <div class="insight-card"><h4>Carburante al km</h4><p id="insight-fuel-km">â€“</p></div>
          </div>
        </section>
        <hr style="border:none;border-top:1px solid var(--border);margin:16px 0;">

        <!-- Gare -->
        <section aria-labelledby="race-title">
          <div class="section-title">
            <h3 id="race-title" style="margin:0">Gare</h3>
            <div class="button-row">
              <button type="button" id="btn-add-race" class="primary" aria-label="Aggiungi gara">+ Aggiungi</button>
              <button type="button" id="btn-fill-default" class="secondary" title="Carica 20 gare tipo">Autoriempi</button>
              <button type="button" id="btn-clear-races" class="ghost" title="Rimuovi tutte le gare">Svuota</button>
            </div>
          </div>

          <!-- Form inline -->
          <div class="row" style="margin-bottom:8px" id="add-form" hidden>
            <label class="col-6"><span>Titolo</span><input id="race-title-input" type="text" placeholder="Granfondo X"></label>
            <label class="col-6"><span>Luogo</span><input id="race-place-input" type="text" placeholder="CittÃ , Prov."></label>
            <label class="col-3"><span>Km viaggio (A/R)</span><input id="race-km-input" type="number" min="0" step="10" placeholder="400"></label>
            <label class="col-3"><span>Iscrizione (â‚¬)</span><input id="race-reg-input" type="number" min="0" step="5" placeholder="60"></label>
            <label class="col-3"><span>Alloggio (â‚¬)</span><input id="race-lodge-input" type="number" min="0" step="10" placeholder="150"></label>
            <label class="col-3"><span>Giorni trasf.</span><input id="race-days-input" type="number" min="0" step="0.5" placeholder="1"></label>
            <div class="col-12 button-row">
              <button type="button" id="btn-save-race" class="primary">Aggiungi gara</button>
              <button type="button" id="btn-cancel-race" class="secondary">Annulla</button>
            </div>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>#</th><th>Titolo</th><th>Luogo</th><th>Km (A/R)</th><th>Iscrizione</th><th>Alloggio</th><th>Giorni</th><th>Azioni</th>
                </tr>
              </thead>
              <tbody id="race-list"></tbody>
              <tfoot>
                <tr><th colspan="3">Totale gare</th><th id="sum-km">â€“</th><th id="sum-reg">â€“</th><th id="sum-lodge">â€“</th><th id="sum-days">â€“</th><th></th></tr>
              </tfoot>
            </table>
          </div>
        </section>
      </aside>

      <!-- DESTRA: Risultati -->
      <section class="card">
        <h2>Risultati di budget</h2>
        <div class="button-row" style="margin-bottom:10px;">
          <button id="btn-export-csv" class="secondary">ðŸ“„ Esporta CSV</button>
          <button id="btn-export-pdf" class="primary">ðŸ§¾ Esporta PDF</button>
        </div>
        <div class="summary-grid">
          <div class="summary-box"><h4>Budget stagionale</h4><p id="season-total">â€“</p></div>
          <div class="summary-box"><h4>Spesa media per gara</h4><p id="race-cost">â€“</p></div>
          <div class="summary-box"><h4>Km totali stagione</h4><p id="total-km">â€“</p></div>
          <div class="summary-box"><h4>Giornate in trasferta</h4><p id="total-travel-days">â€“</p></div>
        </div>
        <h3>Dettaglio costi</h3>
        <div class="table-wrapper">
          <table>
            <thead><tr><th>Voce</th><th>Categoria</th><th>Per gara (â‚¬)</th><th>Stagione (â‚¬)</th></tr></thead>
            <tbody id="detail-body"></tbody>
            <tfoot><tr><th colspan="3">Totale spese</th><th id="detail-total">â€“</th></tr></tfoot>
          </table>
        </div>
        <div class="charts-grid">
          <div class="card"><h3>Ripartizione costi</h3><canvas id="pie-chart" aria-label="Ripartizione costi" role="img"></canvas></div>
          <div class="card"><h3>Costi per categoria</h3><canvas id="bar-chart" aria-label="Costi per categoria" role="img"></canvas></div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:32px;">
      <h2>Note</h2>
      <p class="muted">Il calcolo del carburante avviene con la formula <em>(Consumo/100)*Prezzo</em> Ã— km; i pedaggi sono <em>â‚¬/km Ã— km</em>. I costi fissi includono il leasing annualizzato (12 mesi) e l'abbigliamento annuo.</p>
    </section>
  </main>

  <footer style="text-align:center;padding:32px 16px 48px;color:var(--text-muted);font-size:.85rem;">Versione dimostrativa â€” tutti i diritti riservati.</footer>

  <script>
    const MONTHS = 12;
    const state = {
      races: [], // {id,title,place,km,reg,lodge,days}
      fixed: { vehicleMonth: 550, clothingYear: 0 },
      params: { fuelPrice: 1.7, fuelCons100: 14, tollPerKm: 0.00 },
      charts: { pie:null, bar:null }
    };

    // ===== Utils
    const qs = (s)=>document.querySelector(s);
    const qsa = (s)=>[...document.querySelectorAll(s)];
    const â‚¬ = (v)=> new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(isFinite(v)?v:0);
    const fmt = (v)=> new Intl.NumberFormat('it-IT',{maximumFractionDigits:0}).format(isFinite(v)?v:0);
    const percent = (v,t)=> new Intl.NumberFormat('it-IT',{style:'percent',maximumFractionDigits:1}).format(t>0? v/t:0);

    function fuelPerKm(){ return (Number(state.params.fuelCons100)||0)/100 * (Number(state.params.fuelPrice)||0); }

    // ===== Calcoli principali
    function recalc(){
      // Fissi
      const vehicleAnnual = (Number(state.fixed.vehicleMonth)||0) * MONTHS;
      const clothing = Number(state.fixed.clothingYear)||0;
      qs('#insight-annual-vehicle').textContent = â‚¬(vehicleAnnual);
      qs('#insight-fuel-km').textContent = â‚¬(fuelPerKm()) + ' / km';

      // Variabili da gare
      const sumKm = state.races.reduce((s,r)=> s + (Number(r.km)||0), 0);
      const sumReg= state.races.reduce((s,r)=> s + (Number(r.reg)||0), 0);
      const sumLod= state.races.reduce((s,r)=> s + (Number(r.lodge)||0), 0);
      const sumDays= state.races.reduce((s,r)=> s + (Number(r.days)||0), 0);

      const fuelCost = fuelPerKm() * sumKm;
      const tollCost = (Number(state.params.tollPerKm)||0) * sumKm;
      const variableTotal = sumReg + sumLod + fuelCost + tollCost;
      const fixedTotal = vehicleAnnual + clothing;
      const seasonTotal = fixedTotal + variableTotal;

      // Summary
      qs('#race-count-tag').textContent = state.races.length + ' gare';
      qs('#season-total').textContent = â‚¬(seasonTotal);
      qs('#race-cost').textContent = â‚¬(state.races.length ? seasonTotal/state.races.length : seasonTotal);
      qs('#total-km').textContent = fmt(sumKm);
      qs('#total-travel-days').textContent = fmt(sumDays);

      // Tabella dettaglio
      const detail = [
        {name:'Leasing/Auto (annuo)', cat:'Logistica', perRace: state.races.length? vehicleAnnual/state.races.length: vehicleAnnual, season: vehicleAnnual},
        {name:'Abbigliamento (annuo)', cat:'Manutenzione', perRace: state.races.length? clothing/state.races.length: clothing, season: clothing},
        {name:'Iscrizioni', cat:'Iscrizioni', perRace: state.races.length? sumReg/state.races.length: sumReg, season: sumReg},
        {name:'Alloggio', cat:'Trasferte', perRace: state.races.length? sumLod/state.races.length: sumLod, season: sumLod},
        {name:'Carburante', cat:'Trasferte', perRace: state.races.length? fuelCost/state.races.length: fuelCost, season: fuelCost},
        {name:'Pedaggi', cat:'Trasferte', perRace: state.races.length? tollCost/state.races.length: tollCost, season: tollCost},
      ];
      const body = qs('#detail-body');
      body.innerHTML = '';
      detail.forEach(d=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.name}</td><td>${d.cat}</td><td>${â‚¬(d.perRace)}</td><td>${â‚¬(d.season)}</td>`;
        body.appendChild(tr);
      });
      qs('#detail-total').textContent = â‚¬(seasonTotal);

      // Totali in tabella gare
      qs('#sum-km').textContent = fmt(sumKm);
      qs('#sum-reg').textContent = â‚¬(sumReg);
      qs('#sum-lodge').textContent = â‚¬(sumLod);
      qs('#sum-days').textContent = fmt(sumDays);

      // Tabella gare
      renderRaceTable();

      // Grafici
      updateCharts({
        categories: {
          'Logistica': vehicleAnnual,
          'Manutenzione': clothing,
          'Iscrizioni': sumReg,
          'Trasferte (Alloggio)': sumLod,
          'Trasferte (Carburante)': fuelCost,
          'Trasferte (Pedaggi)': tollCost,
        },
        total: seasonTotal
      });
    }

    function renderRaceTable(){
      const tbody = qs('#race-list');
      tbody.innerHTML = '';
      state.races.forEach((r,idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td>${r.title||'-'}</td>
          <td>${r.place||'-'}</td>
          <td>${fmt(r.km)}</td>
          <td>${â‚¬(r.reg)}</td>
          <td>${â‚¬(r.lodge)}</td>
          <td>${fmt(r.days)}</td>
          <td>
            <button type="button" class="secondary" data-edit="${r.id}">Modifica</button>
            <button type="button" class="ghost" data-del="${r.id}">Elimina</button>
          </td>`;
        tbody.appendChild(tr);
      });
      qsa('[data-del]').forEach(b=> b.onclick = ()=>{ state.races = state.races.filter(x=> x.id!==b.dataset.del); recalc(); });
      qsa('[data-edit]').forEach(b=> b.onclick = ()=> startEditRace(b.dataset.edit));
    }

    // ===== Aggiungi/Modifica gara
    let editingId = null;
    function toggleAddForm(show){ qs('#add-form').hidden = !show; }
    function clearForm(){ ['#race-title-input','#race-place-input','#race-km-input','#race-reg-input','#race-lodge-input','#race-days-input'].forEach(s=> qs(s).value=''); editingId=null; }
    function startAddRace(){ clearForm(); toggleAddForm(true); qs('#race-title-input').focus(); }
    function startEditRace(id){
      const r = state.races.find(x=> x.id===id); if(!r) return;
      editingId = id;
      qs('#race-title-input').value = r.title||'';
      qs('#race-place-input').value = r.place||'';
      qs('#race-km-input').value = r.km||0;
      qs('#race-reg-input').value = r.reg||0;
      qs('#race-lodge-input').value = r.lodge||0;
      qs('#race-days-input').value = r.days||0;
      toggleAddForm(true);
    }
    function saveRace(){
      const title = (qs('#race-title-input').value||'').trim();
      const place = (qs('#race-place-input').value||'').trim();
      const km = Number(qs('#race-km-input').value)||0;
      const reg = Number(qs('#race-reg-input').value)||0;
      const lodge = Number(qs('#race-lodge-input').value)||0;
      const days = Number(qs('#race-days-input').value)||0;
      if(editingId){
        const i = state.races.findIndex(x=> x.id===editingId);
        if(i>-1) state.races[i] = { ...state.races[i], title, place, km, reg, lodge, days };
      } else {
        const id = (crypto && crypto.randomUUID)? crypto.randomUUID(): String(Date.now()+Math.random());
        state.races.push({ id, title, place, km, reg, lodge, days });
      }
      toggleAddForm(false); clearForm(); recalc();
    }
    function fillDefaults(){
      state.races = Array.from({length:20}).map((_,i)=>({ id: String(i+1)+'-'+Date.now(), title:`Gara ${i+1}`, place:'LocalitÃ ', km:400, reg:60, lodge:150, days:1 }));
      recalc();
    }
    function clearRaces(){ state.races = []; recalc(); }

    // ===== Grafici
    function updateCharts({categories,total}){
      const labels = Object.keys(categories);
      const values = labels.map(k=> categories[k]);
      const palette = ['#2563eb','#f97316','#14b8a6','#6366f1','#0f9d58','#9333ea','#ef4444'];
      if(state.charts.pie) state.charts.pie.destroy();
      state.charts.pie = new Chart(qs('#pie-chart'), {
        type:'pie',
        data:{ labels, datasets:[{ data: values, backgroundColor: labels.map((_,i)=> palette[i%palette.length]+"CC"), borderColor:'#fff', borderWidth:2 }] },
        options:{ responsive:true, plugins:{ legend:{ position:'bottom' }, tooltip:{ callbacks:{ label: (ctx)=> `${ctx.label}: ${â‚¬(ctx.parsed)} (${percent(ctx.parsed,total)})` } } } }
      });
      if(state.charts.bar) state.charts.bar.destroy();
      state.charts.bar = new Chart(qs('#bar-chart'), {
        type:'bar',
        data:{ labels, datasets:[{ label:'Costo per categoria', data: values, backgroundColor: labels.map((_,i)=> palette[i%palette.length]+"CC"), borderRadius:6 }] },
        options:{ responsive:true, plugins:{ legend:{ display:false }, tooltip:{ callbacks:{ label:(ctx)=> â‚¬(ctx.parsed.y) } } }, scales:{ y:{ beginAtZero:true, ticks:{ callback:(v)=> â‚¬(v) } } } }
      });
    }

    // ===== Esportazioni
    function exportCSV(){
      let csv = 'Titolo;Luogo;Km;Iscrizione;Alloggio;Giorni
';
      state.races.forEach(r=>{ csv += `${r.title};${r.place};${r.km};${r.reg};${r.lodge};${r.days}
`; });
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='budget_stagionale.csv'; a.click(); URL.revokeObjectURL(url);
    }
    async function exportPDF(){
      const { jsPDF } = window.jspdf; const doc = new jsPDF({unit:'pt',format:'a4'});
      const W = doc.internal.pageSize.getWidth(); let y = 40; const pad=24; const line=18;
      doc.setFontSize(18); doc.text('Simulatore Budget Stagionale', pad, y); y+=line;
      doc.setFontSize(12);
      doc.text(`Totale stagione: ${qs('#season-total').textContent}`, pad, y); y+=line;
      doc.text(`Spesa media/gara: ${qs('#race-cost').textContent}`, pad, y); y+=line;
      doc.text(`Km totali: ${qs('#total-km').textContent} | Giorni trasferta: ${qs('#total-travel-days').textContent}`, pad, y); y+=line*1.5;
      doc.setFontSize(14); doc.text('Dettaglio gare', pad, y); y+=line;
      doc.setFontSize(10);
      state.races.forEach((r,i)=>{
        const row = `${i+1}. ${r.title||'-'} â€” ${r.place||'-'} | Km: ${r.km} | Iscriz.: ${r.reg}â‚¬ | Alloggio: ${r.lodge}â‚¬ | Giorni: ${r.days}`;
        doc.text(row, pad, y, {maxWidth: W-pad*2}); y+=14; if(y>770){ doc.addPage(); y=40; }
      });
      // Grafici come immagini (se esistono)
      try{
        const pie = document.getElementById('pie-chart');
        const bar = document.getElementById('bar-chart');
        if(pie && bar){
          const pieImg = document.getElementById('pie-chart').toDataURL('image/png',1.0);
          const barImg = document.getElementById('bar-chart').toDataURL('image/png',1.0);
          doc.addPage(); y=40; doc.setFontSize(14); doc.text('Grafici', pad, y); y+=10;
          const imgW = W - pad*2; const imgH = imgW * 0.42;
          doc.addImage(pieImg,'PNG',pad,y,imgW,imgH); y+=imgH+16;
          doc.addImage(barImg,'PNG',pad,y,imgW,imgH);
        }
      }catch(e){ /* opzionale: ignora errori grafici */ }
      doc.save('budget_stagionale.pdf');
    }

    // ===== Binding eventi e defaults
    function bind(){
      // fissi
      qs('#fixed-vehicle-month').addEventListener('input', e=>{ state.fixed.vehicleMonth = Number(e.target.value)||0; recalc(); });
      qs('#fixed-clothing').addEventListener('input', e=>{ state.fixed.clothingYear = Number(e.target.value)||0; recalc(); });
      // parametri
      qs('#fuel-price').addEventListener('input', e=>{ state.params.fuelPrice = Number(e.target.value)||0; recalc(); });
      qs('#fuel-cons').addEventListener('input', e=>{ state.params.fuelCons100 = Number(e.target.value)||0; recalc(); });
      qs('#toll-per-km').addEventListener('input', e=>{ state.params.tollPerKm = Number(e.target.value)||0; recalc(); });
      // gare
      qs('#btn-add-race').addEventListener('click', ()=> startAddRace());
      qs('#btn-fill-default').addEventListener('click', ()=> fillDefaults());
      qs('#btn-clear-races').addEventListener('click', ()=> clearRaces());
      qs('#btn-save-race').addEventListener('click', ()=> saveRace());
      qs('#btn-cancel-race').addEventListener('click', ()=> { toggleAddForm(false); clearForm(); });
      // export
      qs('#btn-export-csv').addEventListener('click', exportCSV);
      qs('#btn-export-pdf').addEventListener('click', exportPDF);
    }

    function setDefaults(){
      state.fixed.vehicleMonth = 550; // â‚¬ / mese
      state.fixed.clothingYear = 0;   // modificabile
      state.params.fuelPrice = 1.7;
      state.params.fuelCons100 = 14;
      state.params.tollPerKm = 0.00; // se vuoi: 0.08
      qs('#fixed-vehicle-month').value = state.fixed.vehicleMonth;
      qs('#fixed-clothing').value = state.fixed.clothingYear;
      qs('#fuel-price').value = state.params.fuelPrice;
      qs('#fuel-cons').value = state.params.fuelCons100;
      qs('#toll-per-km').value = state.params.tollPerKm;
    }

    document.addEventListener('DOMContentLoaded', ()=>{ setDefaults(); bind(); recalc(); });
  </script>
</body>
</html>
